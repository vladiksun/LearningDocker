# a cluster with 3 control-plane nodes and 3 workers
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
  #  - role: control-plane
  #  - role: control-plane
  - role: control-plane
    kubeadmConfigPatches:
    - |
      kind: InitConfiguration
      nodeRegistration:
        kubeletExtraArgs:
          node-labels: "ingress-ready=true"
          authorization-mode: "AlwaysAllow"
    extraPortMappings:
      # extraPortMappings allow the local host to make requests to the Ingress controller over ports 80/443
      - containerPort: 80
        hostPort: 80
        protocol: TCP
      - containerPort: 443
        hostPort: 443
        protocol: TCP

  - role: worker
    extraPortMappings:
      - containerPort: 30001 # this port can be used as a NodePort to expose a service
        hostPort: 30001
      - containerPort: 8090
        hostPort: 8090
  - role: worker
    extraPortMappings:
      - containerPort: 30002
        hostPort: 30002
  - role: worker
    extraPortMappings:
      - containerPort: 30003
        hostPort: 30003
#        listenAddress: "0.0.0.0" # Optional, defaults to "0.0.0.0"
#        protocol: udp # Optional, defaults to tcp